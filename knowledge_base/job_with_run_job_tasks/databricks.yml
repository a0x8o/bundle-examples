bundle:
  name: job_with_run_job_tasks

variables:
  instance_pool_id:
    lookup:
      instance_pool: "shared test pool"

workspace:
  host: https://e2-dogfood.staging.cloud.databricks.com

resources:
  jobs:
    primary:
      name: primary job

      tasks:
        - task_key: run_leaf1
          run_job_task:
            job_id: ${resources.jobs.leaf1.id}

        - task_key: run_leaf2
          depends_on:
            - task_key: run_leaf1
          run_job_task:
            job_id: ${resources.jobs.leaf2.id}

      parameters:
        - name: input
          default: test_propagation

    leaf1:
      name: leaf job 1

      job_clusters:
        - job_cluster_key: job_cluster
          new_cluster:
            instance_pool_id: ${var.instance_pool_id}
            num_workers: 0
            spark_version: 14.3.x-scala2.12
            spark_conf:
              "spark.master": "local[*, 4]"
              "spark.databricks.cluster.profile": "singleNode"
            custom_tags:
              ResourceClass: SingleNode

      tasks:
        - task_key: leaf
          spark_python_task:
            python_file: ./argv.py
            parameters:
              - "{{ job.parameters.[input] }}"
          job_cluster_key: job_cluster

      parameters:
        - name: input
          default: ""

    leaf2:
      name: leaf job 2

      job_clusters:
        - job_cluster_key: job_cluster
          new_cluster:
            instance_pool_id: ${var.instance_pool_id}
            num_workers: 0
            spark_version: 14.3.x-scala2.12
            spark_conf:
              "spark.master": "local[*, 4]"
              "spark.databricks.cluster.profile": "singleNode"
            custom_tags:
              ResourceClass: SingleNode

      tasks:
        - task_key: leaf
          spark_python_task:
            python_file: ./argv.py
            parameters:
              - "{{ job.parameters.[input] }}"
          job_cluster_key: job_cluster

      parameters:
        - name: input
          default: ""

targets:
  dev:
    default: true
    mode: development
